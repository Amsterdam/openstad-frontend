{% set pageTitle = 'Jouw plan insturen' %}
{% set showForm = true %}
{% set summaryMaxLength = 140 %}
{% set idea = data.idea %}
{% set isOwner = data.openstadUser.id === idea.userId %}
{% set isOwnerOrAdmin =(isOwner or data.isAdmin) %}

{% if idea and isOwnerOrAdmin %}
{% set showForm = true %}
{% elseif (not idea) %}
{% set showForm = true %}
{% else %}
{% set showForm = false %}
{% endif %}

<div class="pageContent newIdea" id="content">
	{% if not showForm %}
	<div class="box-grey">
		<h1> Je hebt geen rechten voor deze pagina </h1>
	</div>
	{% elseif showForm %}
		<div  id="formulier-block">
			<form method="post" id="js-form" action="/modules/idea-form-widgets/submit" class="idea-form">
					<div id="titleAndSummary">
						<div class="form-group">
							<h4>Naam</h4>
							<p>
								{{data.openstadUser.firstName}} <em>(je emailadres wordt nooit gepubliceerd)</em>
							</p>
						</div>
						<div class="form-group">
							<h2>Samenvatting</h2>
							<div class="form-info">Vertel in maximaal {{summaryMaxLength}} tekens iets meer over je plan.</div>
							<textarea name="summary" required maxlength="{{summaryMaxLength}}">{{idea.summary}}</textarea>
							<div id="charsLeft">Je hebt nog <span>{{summaryMaxLength}}</span> tekens over.</div>
						</div>
					</div>
					<div class="form-group">
						<h2>Titel plan</h2>
						<div class="form-info">Geef je voorstel een duidelijke naam, zodat anderen jouw inzending makkelijk kunnen vinden en direct snappen waar het over gaat.</div>
						<input type="text" name="title" value="{{idea.title}}" required><br />
						<input type="hidden" id="extraData" name="extraData" value=""><br />
					</div>
					<div class="form-group">
						{% if data.global.areas and data.global.areas.length > 0 %}
						<h2>Gebied</h2>
						<div class="form-info">
							Selecteer het gebied waarop jouw plan betrekking heeft. Gaat het niet over een specifiek gebied? Kies dan voor algemeen.
						</div>
						<select id="gebied" class="default-select" name="area" value="{% if idea.extraData %}{{idea.extraData.area}}{% endif %}">
							<option value="">Kies gebied</option>
							<option value="" {% if not idea.extraData.area %}selected{% endif %}>Algemeen</option>
							{% for area in data.global.areas %}
								<option value="{{area.value}}" {% if (idea.extraData) and (idea.extraData.area === area.value) %}selected{% endif %}>{{area.value}}</option>
							{% endfor %}
						</select>
						<br />
						{% endif %}
					</div>
					<div class="form-group">
						{% if data.global.themes and data.global.themes.length > 0 %}
						<h2>Thema</h2>
						<div class="form-info">
							Selecteer het thema waarop jouw plan betrekking heeft.
						</div>

						<select id="thema" name="theme" class="default-select" value="{% if idea.extraData %}{{idea.extraData.theme}}{% endif %}">
							<option value="">Kies thema</option>
							{% for theme in data.global.themes %}
							<option value="{{theme.value}}" {% if (idea.extraData) and (idea.extraData.theme == "theme.value") %}selected{% endif %}>{{theme.value}}</option>
							{% endfor %}
						</select>
						<br />
						{% endif %}
					</div>

					<div class="form-group">
						<div id="imageUpload">
							<h2>Plaatjes</h2>
							<div class="form-info">
							 Let op: Stuur alleen een foto mee die je zelf gemaakt hebt! Foto's van anderen kunnen auteursrechtelijk beschermd zijn. Je hebt toestemming nodig van de fotograaf om die foto te uploaden.
							</div>
							<fieldset class="filepondFieldset">
								<!-- a list of already uploaded files -->
								{% if idea.extraData.images %}
						    {#<ul>
									{% for image in idea.extraData.images %}
						        <li>
						            <label>
						                <input value="{{image}}" data-type="remote" checked type="checkbox">
						                {{image}}
						            </label>
						        </li>
										{% endfor %}
						    </ul>#}
								{% endif %}

								<script>
									var ideaFiles = [];
									<!-- a list of already uploaded files -->
									{% if idea.extraData.images %}
									{% for image in idea.extraData.images %}
									ideaFiles.push({
										source: '{"url":"{{image}}"}',
										options : {
											type: 'local',
													// mock file information
											 file: {
													 name: '{{image}}',
											//		 size: 3001025,
												//	 type: 'image/png'
											},
											metadata: {
		                    poster: '{{image}}',
		                	}
										}

									});
									{% endfor %}
									{% endif %}
								</script>
								<input type="file" class="imageUploader filepond" multiple />

							</fieldset>
							<input type="hidden" name="validateImages" multiple />
						</div>
					</div>
					<div class="form-group">
						<div id="description">
							<h2>Beschrijving</h2>
							<div class="form-info">
								Gebruik de ruimte hieronder om je voorstel verder uit te leggen.
							{#	<ul>
									<li>Wat is het verhaal achter jouw plan?</li>
									<li>Waarom past dit plan goed bij het thema dat je geselecteerd hebt?</li>
									<li>Is het een plan dat je zelf wilt uitvoeren, of moet het door een organisatie of de gemeente uitgevoerd worden?</li>
									<li>Wat wil je ermee bereiken?</li>
									<li>Draag argumenten aan om mensen uit West te overtuigen op jouw plan te stemmen. Je plan heeft minimaal 50 stemmen nodig om door te gaan naar de volgende fase.</li>
								</ul>
								#}
							</div>

							<trix-toolbar id="trixToolbar">
								<div class="button_row">
									<span class="button_group text_tools">
										<button type="button" class="icon heading-1" data-trix-attribute="heading1" title="Titel">Heading</button>
										<button type="button" class="icon bold" data-trix-attribute="bold" data-trix-key="b" title="Vetgedrukt">Bold</button>
										<button type="button" class="icon italic" data-trix-attribute="italic" data-trix-key="i" title="Cursief">Italic</button>
										{# <button type="button" class="icon strike" data-trix-attribute="strike" title="Doorstrepen">Strikethrough</button> #}
										<button type="button" class="icon link" data-trix-attribute="href" data-trix-action="link" data-trix-key="k" title="Link">Link</button>
									</span>

									<span class="button_group text_tools">
										{# <button type="button" class="icon quote" data-trix-attribute="quote" title="Quote">Quote</button>
										<button type="button" class="icon code" data-trix-attribute="code" title="Code">Code</button> #}
										<button type="button" class="icon list bullets" data-trix-attribute="bullet" title="Opsomming">Bullets</button>
										<button type="button" class="icon list numbers" data-trix-attribute="number" title="Genummerde lijst">Numbers</button>
										<button type="button" class="icon nesting-level decrease" data-trix-action="decreaseNestingLevel" title="Inspringen vergroten" disabled="">Decrease Level</button>
										<button type="button" class="icon nesting-level increase" data-trix-action="increaseNestingLevel" title="Inspringen verkleinen" disabled="">Increase Level</button>
									</span>

									{# <span class="button_group history_tools">
									<button type="button" class="icon undo" data-trix-action="undo" data-trix-key="z" title="Undo" disabled="">Undo</button>
									<button type="button" class="icon redo" data-trix-action="redo" data-trix-key="shift+z" title="Redo" disabled="">Redo</button>
									</span> #}
								</div>

								<div class="dialogs">
									<div class="dialog link_dialog" data-trix-attribute="href" data-trix-dialog="href">
										<div class="link_url_fields">
											<input type="url" required="" name="href" placeholder="Enter a URLâ€¦">
											<div class="button_group">
												<input type="button" value="Link" data-trix-method="setAttribute">
												<input type="button" value="Unlink" data-trix-method="removeAttribute">
											</div>
										</div>
									</div>
								</div>
							</trix-toolbar>
							<trix-editor id="js-editor" class="userContentEditor" input="js-description" toolbar="trixToolbar"></trix-editor>
								<input
									type="hidden"
									id="js-description"
									name="description"
									value="{{idea.description}}"
									required
									minlength="140"
								/>

								<input type="hidden" name="redirect" value="{{data.widget.redirect}}" />
								<div id="charsLeftMain">Nog minimaal <span>140</span> tekens.</div><br/><br/>

								{% if idea.id %}
								<input type="hidden" name="id" value="{{idea.id}}" />
								<input type="hidden" name="_method" value="PUT" />
								{% endif %}

								<input type="hidden" name="_csrf" value="{{data.csrfToken}}" />
						</div>
					</div>
					<div class="form-group">
						<div id="location">
							<h2>Locatie</h2>
							<div class="form-info" style="height: auto;">Heeft jouw plan betrekking op een specifieke plek? Klik dan op de juiste locatie in de kaart om een vlaggetje te plaatsen. Verwijder het vlaggetje door hem nogmaals aan te klikken.</div>

							<div id="mapcontainer">
								{% set editorInputElementId = 'locationField' %}
								{% include 'includes/openstad-map.html'  %}
							</div>
						</div>
					</div>

				{% if idea %}
				<input type="hidden" name="ideaId" value="{{idea.id}}">
				{% endif %}
				<input type="submit" value="Plan opslaan">

			</form>
		</div>

		{% if idea %}
		<br />
		<div style="background: #efefef; padding: 5px 30px; margin: 60px 0 20px;">
			<div class="row">
				<div class="col-xs-12">
					<h4> Beheren </h4>
				</div>
				{% if data.isAdmin %}
				<div class="col-xs-8">

				<form method="POST" action="/modules/idea-form-widgets/submit">
					<input type="hidden" name="action" value="UPDATE_STATUS">
					<div class="row">
						<div class="col-xs-6">
							<select name="status"  class="button status default-select">
								<option {{'selected' if idea.status=='OPEN'}}     value="OPEN">    Status: Open</option>
								<option {{'selected' if idea.status=='CLOSED'}}     value="CLOSED">    Status: Gesloten</option>
								<option {{'selected' if idea.status=='DENIED'}}   value="DENIED">  Status: Afgewezen</option>
							</select>
						</div>
						<div class="col-xs-6">
							<input type="submit" value="Opslaan" style=" float: none;" onclick="return confirm('Zeker?')">
						</div>
					</div>


					<input type="hidden" name="ideaId" value="{{idea.id}}">
					<input type="hidden" name="_method" value="PUT">
					<input type="hidden" name="_csrf" value="{{data.csrfToken}}">
				</form>
				</div>
				{% endif %}
				<div class="col-xs-4">
				<form method="post" id="js-form" action="/modules/idea-form-widgets/submit" >
					<input type="hidden" name="ideaId" value="{{idea.id}}">
					<input type="hidden" name="action" value="DELETE">
					<input type="submit" value="Plan verwijderen" style="background: red; float: none;" onclick="return confirm('Zeker?')">
				</form>
				</div>


		<!--		<form method="GET" action="/plan/{{idea.id}}/mod_break">
					<button type="submit" class="modBreak">Moderator reactie</button>
				</form>
	!-->
			</div>

		</div>
		{% endif %}



	{% endif %}
</div>
<script src="https://unpkg.com/filepond-polyfill/dist/filepond-polyfill.js"></script>
<script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"></script>
<script src="https://unpkg.com/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js"></script>
<script src="https://unpkg.com/filepond-plugin-file-validate-size/dist/filepond-plugin-file-validate-size.js"></script>
<script src="https://unpkg.com/filepond-plugin-file-poster/dist/filepond-plugin-file-poster.js"></script>
